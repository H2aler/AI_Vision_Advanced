<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TensorFlow.js AI Vision - 실제 신경망 시스템</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0/dist/mobilenet.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3/dist/coco-ssd.min.js"></script>
    <!-- 호환성 문제로 일시적으로 주석 처리
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection@2.1.0/dist/pose-detection.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection@1.0.2/dist/face-landmarks-detection.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose@0.0.7/dist/handpose.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface@1.0.0/dist/blazeface.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/toxicity@1.2.2/dist/toxicity.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder@1.3.3/dist/universal-sentence-encoder.min.js"></script>
    -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #00ffff;
            overflow: hidden;
            height: 100vh;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .control-panel {
            width: 350px;
            background: rgba(0, 0, 0, 0.9);
            border-right: 2px solid #00ffff;
            padding: 20px;
            overflow-y: auto;
        }

        .main-view {
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .canvas-container {
            flex: 1;
            position: relative;
        }

        #canvas {
            display: block;
            background: #000;
            border: 2px solid #00ffff;
            max-width: 100%;
            max-height: 100%;
        }

        #webcam {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.3;
        }

        .section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid #00ffff;
            border-radius: 5px;
        }

        .section h3 {
            color: #00ffff;
            margin-bottom: 10px;
            font-size: 14px;
            text-transform: uppercase;
        }

        .control-group {
            margin-bottom: 10px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
        }

        .control-group input[type="range"] {
            width: 100%;
            background: #333;
            outline: none;
        }

        .control-group input[type="checkbox"] {
            margin-right: 8px;
        }

        .button {
            background: linear-gradient(45deg, #00ffff, #0080ff);
            border: none;
            color: #000;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 3px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .button:hover {
            background: linear-gradient(45deg, #00ccff, #0066cc);
            transform: translateY(-2px);
        }

        .button.active {
            background: linear-gradient(45deg, #ff0080, #ff00ff);
        }

        .button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border: 1px solid #00ffff;
            border-radius: 5px;
            font-size: 12px;
            min-width: 200px;
        }

        .info-panel {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border: 1px solid #00ffff;
            border-radius: 5px;
            font-size: 12px;
            max-width: 300px;
        }

        .model-status {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border: 2px solid #00ffff;
            border-radius: 10px;
            text-align: center;
            font-size: 14px;
            z-index: 1000;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #00ffff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .prediction-list {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }

        .prediction-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            padding: 5px;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 3px;
        }

        .confidence-bar {
            width: 100px;
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
            margin-left: 10px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #ffff00, #00ff00);
            transition: width 0.3s ease;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 8px 16px;
            background: linear-gradient(45deg, #ff0080, #ff00ff);
            color: white;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .file-label:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="control-panel">
            <div class="section">
                <h3>TensorFlow.js AI 제어</h3>
                <button class="button" onclick="toggleWebcam()">웹캠 활성화</button>
                <button class="button" onclick="loadImage()">이미지 업로드</button>
                <button class="button" onclick="resetModels()">모델 재로드</button>
                <input type="file" id="imageInput" class="file-input" accept="image/*" onchange="handleImageUpload(event)">
                <label for="imageInput" class="file-label">이미지 선택</label>
            </div>

            <div class="section">
                <h3>AI 모델 선택</h3>
                <div class="control-group">
                    <input type="checkbox" id="mobilenetModel" checked onchange="toggleModel('mobilenet')">
                    <label for="mobilenetModel">MobileNet (이미지 분류)</label>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="cocoModel" checked onchange="toggleModel('coco')">
                    <label for="cocoModel">COCO-SSD (객체 감지)</label>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="poseModel" onchange="toggleModel('pose')">
                    <label for="poseModel">Pose Detection (자세 감지)</label>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="faceModel" onchange="toggleModel('face')">
                    <label for="faceModel">Face Landmarks (얼굴 랜드마크)</label>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="handModel" onchange="toggleModel('hand')">
                    <label for="handModel">Hand Pose (손 제스처)</label>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="blazefaceModel" onchange="toggleModel('blazeface')">
                    <label for="blazefaceModel">BlazeFace (얼굴 감지)</label>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="customModel" onchange="toggleModel('custom')">
                    <label for="customModel">커스텀 신경망</label>
                </div>
            </div>

            <div class="section">
                <h3>객체 감지 설정</h3>
                <div class="control-group">
                    <label for="detectionThreshold">감지 임계값</label>
                    <input
                        type="range"
                        id="detectionThreshold"
                        min="0"
                        max="100"
                        value="50"
                        title="감지 임계값을 조정하세요"
                        placeholder="감지 임계값"
                        onchange="updateDetectionSettings()"
                    >
                </div>
                <div class="control-group">
                    <label for="maxObjects">최대 객체 수</label>
                    <input
                        type="range"
                        id="maxObjects"
                        min="1"
                        max="20"
                        value="10"
                        title="최대 객체 수를 조정하세요"
                        placeholder="최대 객체 수"
                        onchange="updateDetectionSettings()"
                    >
                </div>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="showBoundingBoxes" checked onchange="updateDetectionSettings()">
                    <label for="showBoundingBoxes">바운딩 박스 표시</label>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="showConfidence" checked onchange="updateDetectionSettings()">
                    <label for="showConfidence">신뢰도 표시</label>
                </div>
            </div>

            <div class="section">
                <h3>이미지 분류 설정</h3>
                <div class="control-group">
                    <label for="topK">상위 결과 수</label>
                    <input
                        type="range"
                        id="topK"
                        min="1"
                        max="10"
                        value="5"
                        title="상위 결과 수를 조정하세요"
                        placeholder="상위 결과 수"
                        onchange="updateClassificationSettings()"
                    >
                </div>
                <div class="control-group">
                    <label for="minConfidence">최소 신뢰도</label>
                    <input
                        type="range"
                        id="minConfidence"
                        min="0"
                        max="100"
                        value="20"
                        title="최소 신뢰도를 조정하세요"
                        placeholder="최소 신뢰도"
                        onchange="updateClassificationSettings()"
                    >
                </div>
                <div class="control-group">
                    <input type="checkbox" id="showPredictions" checked onchange="updateClassificationSettings()">
                    <label for="showPredictions">예측 결과 표시</label>
                </div>
            </div>

            <div class="section">
                <h3>신경망 시각화</h3>
                <div class="control-group">
                    <input type="checkbox" id="showNeuralNetwork" onchange="toggleNeuralNetwork()">
                    <label for="showNeuralNetwork">신경망 구조 표시</label>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="showActivations" onchange="toggleActivations()">
                    <label for="showActivations">활성화 맵 표시</label>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="showGradients" onchange="toggleGradients()">
                    <label for="showGradients">그래디언트 시각화</label>
                </div>
            </div>

            <div class="section">
                <h3>실시간 분석</h3>
                <div class="control-group">
                    <input type="checkbox" id="realTimeAnalysis" onchange="toggleRealTimeAnalysis()">
                    <label for="realTimeAnalysis">실시간 분석</label>
                </div>
                <div class="control-group">
                    <label>분석 주기 (ms)</label>
                    <input type="range" id="analysisInterval" min="100" max="2000" value="500" onchange="updateAnalysisInterval()">
                </div>
            </div>

            <div class="section">
                <h3>고급 AI 기능</h3>
                <div class="control-group">
                    <input type="checkbox" id="emotionDetection" onchange="toggleEmotionDetection()">
                    <label for="emotionDetection">감정 분석</label>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="gestureRecognition" onchange="toggleGestureRecognition()">
                    <label for="gestureRecognition">제스처 인식</label>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="poseTracking" onchange="togglePoseTracking()">
                    <label for="poseTracking">자세 추적</label>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="faceAnalysis" onchange="toggleFaceAnalysis()">
                    <label for="faceAnalysis">얼굴 분석</label>
                </div>
            </div>

            <div class="section">
                <h3>AI 생성 기능</h3>
                <div class="control-group">
                    <input type="checkbox" id="styleTransfer" onchange="toggleStyleTransfer()">
                    <label for="styleTransfer">스타일 전이</label>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="imageGeneration" onchange="toggleImageGeneration()">
                    <label for="imageGeneration">이미지 생성</label>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="textToImage" onchange="toggleTextToImage()">
                    <label for="textToImage">텍스트→이미지</label>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="voiceSynthesis" onchange="toggleVoiceSynthesis()">
                    <label for="voiceSynthesis">음성 합성</label>
                </div>
            </div>

            <div class="section">
                <h3>데이터 분석</h3>
                <div class="control-group">
                    <input type="checkbox" id="dataRecording" onchange="toggleDataRecording()">
                    <label for="dataRecording">데이터 기록</label>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="performanceMetrics" onchange="togglePerformanceMetrics()">
                    <label for="performanceMetrics">성능 지표</label>
                </div>
                <div class="control-group">
                    <input type="checkbox" id="neuralNetworkTraining" onchange="toggleNeuralNetworkTraining()">
                    <label for="neuralNetworkTraining">신경망 훈련</label>
                </div>
                <div class="control-group">
                    <button class="button" onclick="exportData()">데이터 내보내기</button>
                    <button class="button" onclick="saveModel()">모델 저장</button>
                </div>
            </div>
        </div>

        <div class="main-view">
            <div class="canvas-container">
                <canvas id="canvas" width="800" height="600"></canvas>
                <video id="webcam" autoplay muted playsinline style="display: none;"></video>
                
                <div class="status" id="status">
                    <div>FPS: <span id="fps">0</span></div>
                    <div>모델 상태: <span id="modelStatus">로딩 중...</span></div>
                    <div>감지된 객체: <span id="objectCount">0</span></div>
                    <div>분류 결과: <span id="classificationCount">0</span></div>
                    <div>메모리 사용량: <span id="memoryUsage">0 MB</span></div>
                </div>

                <div class="info-panel" id="infoPanel">
                    <div><strong>TensorFlow.js AI Vision</strong></div>
                    <div>실제 신경망 기반 분석</div>
                    <div>MobileNet + COCO-SSD</div>
                </div>

                <div class="model-status" id="modelStatusOverlay" style="display: none;">
                    <div class="loading"></div>
                    <div>AI 모델 로딩 중...</div>
                    <div id="loadingProgress">0%</div>
                </div>
            </div>

            <div class="prediction-list" id="predictionList" style="display: none;">
                <h4>AI 예측 결과</h4>
                <div id="predictions"></div>
            </div>
        </div>
    </div>

    <script>
        class TensorFlowAIVision {
            constructor() {
                this.canvas = document.getElementById('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.webcam = document.getElementById('webcam');
                this.time = 0;
                this.lastTime = 0;
                this.fps = 0;
                this.frameCount = 0;
                
                // TensorFlow.js 모델들
                this.models = {
                    mobilenet: null,
                    coco: null,
                    pose: null,
                    face: null,
                    hand: null,
                    blazeface: null,
                    toxicity: null,
                    sentenceEncoder: null,
                    custom: null
                };
                
                // 모델 상태
                this.modelStatus = {
                    mobilenet: false,
                    coco: false,
                    pose: false,
                    face: false,
                    hand: false,
                    blazeface: false,
                    toxicity: false,
                    sentenceEncoder: false,
                    custom: false
                };
                
                // 설정
                this.settings = {
                    detectionThreshold: 0.5,
                    maxObjects: 10,
                    showBoundingBoxes: true,
                    showConfidence: true,
                    topK: 5,
                    minConfidence: 0.2,
                    showPredictions: true,
                    realTimeAnalysis: false,
                    analysisInterval: 500
                };
                
                // 분석 결과
                this.predictions = [];
                this.detections = [];
                
                // 실시간 분석 타이머
                this.analysisTimer = null;
                
                this.initialize();
            }
            
            async initialize() {
                this.showModelStatus('TensorFlow.js 초기화 중...');
                
                // TensorFlow.js 초기화 - WebGL 백엔드 우선 사용
                await tf.setBackend('webgl');
                await tf.ready();
                console.log('TensorFlow.js 로드됨:', tf.version);
                console.log('현재 백엔드:', tf.getBackend());
                
                // 모델 로드
                await this.loadModels();
                
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
                this.animate();
                
                this.hideModelStatus();
                this.updateStatus();
            }
            
            async loadModels() {
                try {
                    // MobileNet 모델 로드
                    this.showModelStatus('MobileNet 모델 로딩 중...', 10);
                    this.models.mobilenet = await mobilenet.load();
                    this.modelStatus.mobilenet = true;
                    console.log('MobileNet 모델 로드됨');
                    
                    // COCO-SSD 모델 로드
                    this.showModelStatus('COCO-SSD 모델 로딩 중...', 20);
                    this.models.coco = await cocoSsd.load();
                    this.modelStatus.coco = true;
                    console.log('COCO-SSD 모델 로드됨');
                    
                    // 호환성 문제로 일시적으로 비활성화된 모델들
                    this.showModelStatus('고급 모델들 로딩 중...', 30);
                    console.log('고급 모델들은 호환성 문제로 일시 비활성화됨');
                    
                    // 진행률 조정
                    this.showModelStatus('커스텀 신경망 생성 중...', 80);
                    
                    // 커스텀 신경망 생성
                    this.showModelStatus('커스텀 신경망 생성 중...', 90);
                    this.models.custom = this.createCustomNeuralNetwork();
                    this.modelStatus.custom = true;
                    console.log('커스텀 신경망 생성됨');
                    
                    // 로드된 모델 수 계산
                    const loadedModels = Object.values(this.modelStatus).filter(status => status).length;
                    const totalModels = Object.keys(this.modelStatus).length;
                    
                    this.showModelStatus(`${loadedModels}/${totalModels} 모델 로드 완료!`, 100);
                    setTimeout(() => this.hideModelStatus(), 1000);
                    
                } catch (error) {
                    console.error('모델 로드 실패:', error);
                    this.showModelStatus('모델 로드 실패: ' + error.message);
                }
            }
            
            createCustomNeuralNetwork() {
                // 간단한 커스텀 신경망 생성
                const model = tf.sequential();
                
                // 입력 레이어 (224x224x3 이미지)
                model.add(tf.layers.conv2d({
                    inputShape: [224, 224, 3],
                    filters: 32,
                    kernelSize: 3,
                    activation: 'relu'
                }));
                
                model.add(tf.layers.maxPooling2d({ poolSize: 2 }));
                
                model.add(tf.layers.conv2d({
                    filters: 64,
                    kernelSize: 3,
                    activation: 'relu'
                }));
                
                model.add(tf.layers.maxPooling2d({ poolSize: 2 }));
                
                model.add(tf.layers.flatten());
                model.add(tf.layers.dense({ units: 128, activation: 'relu' }));
                model.add(tf.layers.dropout({ rate: 0.5 }));
                model.add(tf.layers.dense({ units: 10, activation: 'softmax' }));
                
                model.compile({
                    optimizer: 'adam',
                    loss: 'categoricalCrossentropy',
                    metrics: ['accuracy']
                });
                
                return model;
            }
            
            showModelStatus(message, progress = 0) {
                const overlay = document.getElementById('modelStatusOverlay');
                const progressElement = document.getElementById('loadingProgress');
                
                overlay.style.display = 'block';
                overlay.querySelector('div:nth-child(2)').textContent = message;
                progressElement.textContent = progress + '%';
                
                document.getElementById('modelStatus').textContent = message;
            }
            
            hideModelStatus() {
                document.getElementById('modelStatusOverlay').style.display = 'none';
                document.getElementById('modelStatus').textContent = '준비됨';
            }
            
            resizeCanvas() {
                const container = this.canvas.parentElement;
                const rect = container.getBoundingClientRect();
                this.canvas.width = rect.width - 4;
                this.canvas.height = rect.height - 4;
            }
            
            animate() {
                const currentTime = performance.now();
                const deltaTime = currentTime - this.lastTime;
                this.lastTime = currentTime;
                
                this.time += deltaTime * 0.001;
                
                // FPS 계산
                this.frameCount++;
                if (this.frameCount % 60 === 0) {
                    this.fps = Math.round(1000 / deltaTime);
                    document.getElementById('fps').textContent = this.fps;
                }
                
                this.update();
                this.render();
                
                requestAnimationFrame(() => this.animate());
            }
            
            update() {
                // 실시간 분석 업데이트
                if (this.settings.realTimeAnalysis && this.webcam.srcObject) {
                    this.analyzeFrame();
                }
            }
            
            async analyzeFrame() {
                if (!this.webcam.videoWidth) return;
                
                try {
                    // 웹캠 프레임을 텐서로 변환
                    const videoTensor = tf.browser.fromPixels(this.webcam);
                    
                    // 이미지 분류
                    if (this.modelStatus.mobilenet && this.settings.showPredictions) {
                        this.predictions = await this.models.mobilenet.classify(this.webcam, this.settings.topK);
                        this.predictions = this.predictions.filter(p => p.probability >= this.settings.minConfidence);
                    }
                    
                    // 객체 감지
                    if (this.modelStatus.coco && this.settings.showBoundingBoxes) {
                        this.detections = await this.models.coco.detect(this.webcam, this.settings.maxObjects, this.settings.detectionThreshold);
                    }
                    
                    // 커스텀 모델 분석
                    if (this.modelStatus.custom) {
                        await this.analyzeWithCustomModel(videoTensor);
                    }
                    
                    // 메모리 정리
                    videoTensor.dispose();
                    
                    this.updateStatus();
                    this.updatePredictionDisplay();
                    
                } catch (error) {
                    console.error('프레임 분석 실패:', error);
                }
            }
            
            async analyzeWithCustomModel(tensor) {
                // 텐서 전처리
                const resized = tf.image.resizeBilinear(tensor, [224, 224]);
                const normalized = resized.div(255.0);
                const batched = normalized.expandDims(0);
                
                // 예측 (커스텀 모델은 훈련되지 않았으므로 랜덤 결과)
                const prediction = this.models.custom.predict(batched);
                const result = await prediction.data();
                
                // 메모리 정리
                resized.dispose();
                normalized.dispose();
                batched.dispose();
                prediction.dispose();
                
                console.log('커스텀 모델 예측:', result);
            }
            
            render() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // 웹캠 비디오가 활성화된 경우
                if (this.webcam.srcObject && this.webcam.videoWidth) {
                    this.ctx.drawImage(this.webcam, 0, 0, this.canvas.width, this.canvas.height);
                }
                
                // 객체 감지 결과 렌더링
                if (this.settings.showBoundingBoxes && this.detections.length > 0) {
                    this.renderDetections();
                }
                
                // 신경망 시각화
                if (document.getElementById('showNeuralNetwork').checked) {
                    this.renderNeuralNetwork();
                }
                
                // 활성화 맵 시각화
                if (document.getElementById('showActivations').checked) {
                    this.renderActivations();
                }
            }
            
            renderDetections() {
                this.detections.forEach(detection => {
                    const bbox = detection.bbox;
                    const score = detection.score;
                    const class_name = detection.class;
                    
                    // 바운딩 박스 그리기
                    this.ctx.strokeStyle = '#00ff00';
                    this.ctx.lineWidth = 2;
                    this.ctx.strokeRect(bbox[0], bbox[1], bbox[2], bbox[3]);
                    
                    // 신뢰도 표시
                    if (this.settings.showConfidence) {
                        this.ctx.fillStyle = '#00ff00';
                        this.ctx.font = '14px Courier New';
                        this.ctx.textAlign = 'left';
                        this.ctx.fillText(
                            `${class_name}: ${(score * 100).toFixed(1)}%`, 
                            bbox[0], 
                            bbox[1] - 5
                        );
                    }
                });
            }
            
            renderNeuralNetwork() {
                // 간단한 신경망 구조 시각화
                const layers = [
                    { name: 'Input', neurons: 150528, x: 50 },
                    { name: 'Conv1', neurons: 32, x: 150 },
                    { name: 'Conv2', neurons: 64, x: 250 },
                    { name: 'Dense1', neurons: 128, x: 350 },
                    { name: 'Output', neurons: 10, x: 450 }
                ];
                
                layers.forEach((layer, index) => {
                    // 레이어 박스
                    this.ctx.strokeStyle = '#00ffff';
                    this.ctx.lineWidth = 1;
                    this.ctx.strokeRect(layer.x, 50, 80, 100);
                    
                    // 레이어 이름
                    this.ctx.fillStyle = '#00ffff';
                    this.ctx.font = '10px Courier New';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText(layer.name, layer.x + 40, 40);
                    
                    // 뉴런 수
                    this.ctx.fillText(layer.neurons.toString(), layer.x + 40, 110);
                    
                    // 연결선
                    if (index < layers.length - 1) {
                        this.ctx.beginPath();
                        this.ctx.moveTo(layer.x + 80, 100);
                        this.ctx.lineTo(layers[index + 1].x, 100);
                        this.ctx.stroke();
                    }
                });
            }
            
            renderActivations() {
                // 활성화 맵 시각화 (간단한 시뮬레이션)
                const activationSize = 32;
                const startX = this.canvas.width - activationSize - 20;
                const startY = 20;
                
                for (let i = 0; i < activationSize; i++) {
                    for (let j = 0; j < activationSize; j++) {
                        const activation = Math.random() * 0.5 + 0.5;
                        const intensity = Math.floor(activation * 255);
                        this.ctx.fillStyle = `rgb(${intensity}, ${intensity}, ${intensity})`;
                        this.ctx.fillRect(startX + j, startY + i, 1, 1);
                    }
                }
                
                // 활성화 맵 제목
                this.ctx.fillStyle = '#00ffff';
                this.ctx.font = '12px Courier New';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('활성화 맵', startX + activationSize / 2, startY - 5);
            }
            
            updateStatus() {
                document.getElementById('objectCount').textContent = this.detections.length;
                document.getElementById('classificationCount').textContent = this.predictions.length;
                
                // 메모리 사용량 표시
                const memoryInfo = tf.memory();
                const memoryMB = (memoryInfo.numBytes / (1024 * 1024)).toFixed(1);
                document.getElementById('memoryUsage').textContent = memoryMB + ' MB';
                
                // 로드된 모델 상태 표시
                const loadedModels = Object.values(this.modelStatus).filter(status => status).length;
                const totalModels = Object.keys(this.modelStatus).length;
                const modelStatusText = `${loadedModels}/${totalModels} 모델 로드됨`;
                document.getElementById('modelStatus').textContent = modelStatusText;
            }
            
            updatePredictionDisplay() {
                const predictionsDiv = document.getElementById('predictions');
                const predictionList = document.getElementById('predictionList');
                
                if (this.predictions.length > 0) {
                    predictionList.style.display = 'block';
                    predictionsDiv.innerHTML = '';
                    
                    this.predictions.forEach(prediction => {
                        const item = document.createElement('div');
                        item.className = 'prediction-item';
                        
                        const confidence = (prediction.probability * 100).toFixed(1);
                        const confidenceWidth = (prediction.probability * 100);
                        
                        item.innerHTML = `
                            <span>${prediction.className}</span>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${confidenceWidth}%"></div>
                            </div>
                            <span>${confidence}%</span>
                        `;
                        
                        predictionsDiv.appendChild(item);
                    });
                } else {
                    predictionList.style.display = 'none';
                }
            }
        }
        
        // 전역 변수
        let aiVision;
        
        // 초기화
        document.addEventListener('DOMContentLoaded', () => {
            aiVision = new TensorFlowAIVision();
        });
        
        // 제어 함수들
        function toggleWebcam() {
            const webcam = document.getElementById('webcam');
            const button = event.target;
            
            if (webcam.srcObject) {
                // 웹캠 비활성화
                webcam.srcObject.getTracks().forEach(track => track.stop());
                webcam.srcObject = null;
                webcam.style.display = 'none';
                button.textContent = '웹캠 활성화';
                button.classList.remove('active');
            } else {
                // 웹캠 활성화
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(stream => {
                        webcam.srcObject = stream;
                        webcam.style.display = 'block';
                        button.textContent = '웹캠 비활성화';
                        button.classList.add('active');
                    })
                    .catch(error => {
                        console.error('웹캠 접근 실패:', error);
                        alert('웹캠에 접근할 수 없습니다.');
                    });
            }
        }
        
        function loadImage() {
            document.getElementById('imageInput').click();
        }
        
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        // 이미지를 캔버스에 그리기
                        const canvas = document.getElementById('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // 이미지 비율 유지하면서 캔버스에 맞추기
                        const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
                        const x = (canvas.width - img.width * scale) / 2;
                        const y = (canvas.height - img.height * scale) / 2;
                        
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
                        
                        // 이미지 분석
                        analyzeImage(img);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }
        
        async function analyzeImage(img) {
            try {
                // 이미지 분류
                if (aiVision.modelStatus.mobilenet) {
                    aiVision.predictions = await aiVision.models.mobilenet.classify(img, aiVision.settings.topK);
                    aiVision.predictions = aiVision.predictions.filter(p => p.probability >= aiVision.settings.minConfidence);
                }
                
                // 객체 감지
                if (aiVision.modelStatus.coco) {
                    aiVision.detections = await aiVision.models.coco.detect(img, aiVision.settings.maxObjects, aiVision.settings.detectionThreshold);
                }
                
                aiVision.updateStatus();
                aiVision.updatePredictionDisplay();
                
            } catch (error) {
                console.error('이미지 분석 실패:', error);
            }
        }
        
        function resetModels() {
            aiVision.showModelStatus('모델 재로딩 중...');
            aiVision.loadModels();
        }
        
        function toggleModel(modelName) {
            aiVision.modelStatus[modelName] = !aiVision.modelStatus[modelName];
            console.log(`${modelName} 모델 상태:`, aiVision.modelStatus[modelName]);
        }
        
        function updateDetectionSettings() {
            aiVision.settings.detectionThreshold = document.getElementById('detectionThreshold').value / 100;
            aiVision.settings.maxObjects = parseInt(document.getElementById('maxObjects').value);
            aiVision.settings.showBoundingBoxes = document.getElementById('showBoundingBoxes').checked;
            aiVision.settings.showConfidence = document.getElementById('showConfidence').checked;
        }
        
        function updateClassificationSettings() {
            aiVision.settings.topK = parseInt(document.getElementById('topK').value);
            aiVision.settings.minConfidence = document.getElementById('minConfidence').value / 100;
            aiVision.settings.showPredictions = document.getElementById('showPredictions').checked;
        }
        
        function toggleRealTimeAnalysis() {
            aiVision.settings.realTimeAnalysis = document.getElementById('realTimeAnalysis').checked;
            
            if (aiVision.settings.realTimeAnalysis) {
                aiVision.analysisTimer = setInterval(() => {
                    if (aiVision.webcam.srcObject) {
                        aiVision.analyzeFrame();
                    }
                }, aiVision.settings.analysisInterval);
            } else {
                if (aiVision.analysisTimer) {
                    clearInterval(aiVision.analysisTimer);
                    aiVision.analysisTimer = null;
                }
            }
        }
        
        function updateAnalysisInterval() {
            aiVision.settings.analysisInterval = parseInt(document.getElementById('analysisInterval').value);
            if (aiVision.settings.realTimeAnalysis) {
                toggleRealTimeAnalysis();
                toggleRealTimeAnalysis();
            }
        }
        
        function toggleNeuralNetwork() {
            // 신경망 시각화 토글
        }
        
        function toggleActivations() {
            // 활성화 맵 토글
        }
        
        function toggleGradients() {
            // 그래디언트 시각화 토글
        }
        
        // 고급 AI 기능 토글 함수들
        function toggleEmotionDetection() {
            const enabled = document.getElementById('emotionDetection').checked;
            console.log('감정 분석:', enabled ? '활성화' : '비활성화');
            if (enabled && aiVision.modelStatus.face) {
                // 감정 분석 로직 구현
            }
        }
        
        function toggleGestureRecognition() {
            const enabled = document.getElementById('gestureRecognition').checked;
            console.log('제스처 인식:', enabled ? '활성화' : '비활성화');
            if (enabled && aiVision.modelStatus.hand) {
                // 제스처 인식 로직 구현
            }
        }
        
        function togglePoseTracking() {
            const enabled = document.getElementById('poseTracking').checked;
            console.log('자세 추적:', enabled ? '활성화' : '비활성화');
            if (enabled && aiVision.modelStatus.pose) {
                // 자세 추적 로직 구현
            }
        }
        
        function toggleFaceAnalysis() {
            const enabled = document.getElementById('faceAnalysis').checked;
            console.log('얼굴 분석:', enabled ? '활성화' : '비활성화');
            if (enabled && aiVision.modelStatus.face) {
                // 얼굴 분석 로직 구현
            }
        }
        
        // AI 생성 기능 토글 함수들
        function toggleStyleTransfer() {
            const enabled = document.getElementById('styleTransfer').checked;
            console.log('스타일 전이:', enabled ? '활성화' : '비활성화');
            // 스타일 전이 로직 구현
        }
        
        function toggleImageGeneration() {
            const enabled = document.getElementById('imageGeneration').checked;
            console.log('이미지 생성:', enabled ? '활성화' : '비활성화');
            // 이미지 생성 로직 구현
        }
        
        function toggleTextToImage() {
            const enabled = document.getElementById('textToImage').checked;
            console.log('텍스트→이미지:', enabled ? '활성화' : '비활성화');
            // 텍스트→이미지 로직 구현
        }
        
        function toggleVoiceSynthesis() {
            const enabled = document.getElementById('voiceSynthesis').checked;
            console.log('음성 합성:', enabled ? '활성화' : '비활성화');
            // 음성 합성 로직 구현
        }
        
        // 데이터 분석 토글 함수들
        function toggleDataRecording() {
            const enabled = document.getElementById('dataRecording').checked;
            console.log('데이터 기록:', enabled ? '활성화' : '비활성화');
            // 데이터 기록 로직 구현
        }
        
        function togglePerformanceMetrics() {
            const enabled = document.getElementById('performanceMetrics').checked;
            console.log('성능 지표:', enabled ? '활성화' : '비활성화');
            // 성능 지표 로직 구현
        }
        
        function toggleNeuralNetworkTraining() {
            const enabled = document.getElementById('neuralNetworkTraining').checked;
            console.log('신경망 훈련:', enabled ? '활성화' : '비활성화');
            // 신경망 훈련 로직 구현
        }
        
        // 데이터 내보내기 및 모델 저장
        function exportData() {
            const data = {
                predictions: aiVision.predictions,
                detections: aiVision.detections,
                settings: aiVision.settings,
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ai_vision_data.json';
            a.click();
            URL.revokeObjectURL(url);
            
            console.log('데이터 내보내기 완료');
        }
        
        function saveModel() {
            if (aiVision.modelStatus.custom) {
                aiVision.models.custom.save('downloads://custom_neural_network');
                console.log('커스텀 모델 저장 완료');
            } else {
                console.log('저장할 커스텀 모델이 없습니다');
            }
        }
    </script>
</body>
</html>
